object apgCustomerSingleSrv: TapgCustomerSingleSrv
  Left = 0
  Top = 0
  Caption = #1056#1072#1079#1086#1074#1099#1077' '#1091#1089#1083#1091#1075#1080
  ClientHeight = 164
  ClientWidth = 755
  Color = clBtnFace
  Font.Charset = DEFAULT_CHARSET
  Font.Color = clWindowText
  Font.Height = -11
  Font.Name = 'Tahoma'
  Font.Style = []
  OldCreateOrder = False
  ShowHint = True
  PixelsPerInch = 96
  TextHeight = 13
  object pnlButtons: TPanel
    Left = 0
    Top = 0
    Width = 26
    Height = 164
    Align = alLeft
    BevelOuter = bvNone
    TabOrder = 0
    DesignSize = (
      26
      164)
    object btnDel1: TSpeedButton
      Left = 2
      Top = 141
      Width = 22
      Height = 22
      Action = actDel
      Anchors = [akLeft, akBottom]
      Flat = True
      Glyph.Data = {
        36040000424D3604000000000000360000002800000010000000100000000100
        2000000000000004000000000000000000000000000000000000FF00FF00FF00
        FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00
        FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00
        FF00FF00FF008C98D600FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00
        FF00FF00FF00FF00FF008390D500FF00FF00FF00FF00FF00FF00FF00FF00FF00
        FF008693D600334CCC003D54CD00FF00FF00FF00FF00FF00FF00FF00FF00FF00
        FF00FF00FF00465CCE00334CCC007584D300FF00FF00FF00FF00FF00FF00909C
        D700334CCC00334CCC00334CCC003D54CD00FF00FF00FF00FF00FF00FF00FF00
        FF00465CCE00334CCC00334CCC00334CCC00808ED500FF00FF00FF00FF00FF00
        FF00445ACE00334CCC00334CCC00334CCC003D54CD00FF00FF00FF00FF00465C
        CE00334CCC00334CCC00334CCC004057CD00FF00FF00FF00FF00FF00FF00FF00
        FF00FF00FF00445ACE00334CCC00334CCC00334CCC003D54CD00455BCE00334C
        CC00334CCC00334CCC004057CD00FF00FF00FF00FF00FF00FF00FF00FF00FF00
        FF00FF00FF00FF00FF00445ACE00334CCC00334CCC00334CCC00334CCC00334C
        CC00334CCC004057CD00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00
        FF00FF00FF00FF00FF00FF00FF00445ACE00334CCC00334CCC00334CCC00334C
        CC004057CD00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00
        FF00FF00FF00FF00FF00FF00FF00465CCE00334CCC00334CCC00334CCC00334C
        CC003D54CD00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00
        FF00FF00FF00FF00FF00465CCE00334CCC00334CCC00334CCC00334CCC00334C
        CC00334CCC003D54CD00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00
        FF00FF00FF00465CCE00334CCC00334CCC00334CCC004057CD00445ACE00334C
        CC00334CCC00334CCC003D54CD00FF00FF00FF00FF00FF00FF00FF00FF00FF00
        FF00465CCE00334CCC00334CCC00334CCC004057CD00FF00FF00FF00FF00445A
        CE00334CCC00334CCC00334CCC003D54CD00FF00FF00FF00FF00FF00FF00ABB2
        DA00364ECC00334CCC00334CCC004057CD00FF00FF00FF00FF00FF00FF00FF00
        FF00445ACE00334CCC00334CCC00354DCC00A4ACD900FF00FF00FF00FF00FF00
        FF00A7AFDA00364ECC004057CD00FF00FF00FF00FF00FF00FF00FF00FF00FF00
        FF00FF00FF00445ACE00354DCC00A2ABD900FF00FF00FF00FF00FF00FF00FF00
        FF00FF00FF00A9B1DA00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00
        FF00FF00FF00FF00FF00A6AED900FF00FF00FF00FF00FF00FF00FF00FF00FF00
        FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00
        FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00}
      Layout = blGlyphTop
    end
    object btnAdd1: TSpeedButton
      Left = 2
      Top = 3
      Width = 22
      Height = 22
      Action = actAdd
      Flat = True
      Glyph.Data = {
        36040000424D3604000000000000360000002800000010000000100000000100
        2000000000000004000000000000000000000000000000000000FF00FF00FF00
        FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00
        FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00
        FF00FF00FF00FF00FF00FF00FF00FF00FF0089AD560089AD560089AD560089AD
        5600FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00
        FF00FF00FF00FF00FF00FF00FF00FF00FF0089AD560089AD560089AD560089AD
        5600FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00
        FF00FF00FF00FF00FF00FF00FF00FF00FF0089AD560089AD560089AD560089AD
        5600FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00
        FF00FF00FF00FF00FF00FF00FF00FF00FF0089AD560089AD560089AD560089AD
        5600FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00
        FF00FF00FF00FF00FF00FF00FF00FF00FF0089AD560089AD560089AD560089AD
        5600FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF008BAE
        5A0089AD560089AD560089AD560089AD560089AD560089AD560089AD560089AD
        560089AD560089AD560089AD560089AD560089AD5600FF00FF00FF00FF008BAE
        5A0089AD560089AD560089AD560089AD560089AD560089AD560089AD560089AD
        560089AD560089AD560089AD560089AD560089AD5600FF00FF00FF00FF008BAE
        5A0089AD560089AD560089AD560089AD560089AD560089AD560089AD560089AD
        560089AD560089AD560089AD560089AD560089AD5600FF00FF00FF00FF008DAF
        5D008BAE59008BAE59008BAE59008BAE590089AD560089AD560089AD560089AD
        56008BAE59008BAE59008BAE59008BAE59008BAE5900FF00FF00FF00FF00FF00
        FF00FF00FF00FF00FF00FF00FF00FF00FF0089AD560089AD560089AD560089AD
        5600FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00
        FF00FF00FF00FF00FF00FF00FF00FF00FF0089AD560089AD560089AD560089AD
        5600FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00
        FF00FF00FF00FF00FF00FF00FF00FF00FF0089AD560089AD560089AD560089AD
        5600FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00
        FF00FF00FF00FF00FF00FF00FF00FF00FF0089AD560089AD560089AD560089AD
        5600FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00
        FF00FF00FF00FF00FF00FF00FF00FF00FF008FB160008FB160008FB160008FB1
        6000FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00
        FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00
        FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00FF00}
    end
  end
  object dbgSingleServ: TDBGridEh
    Left = 26
    Top = 0
    Width = 729
    Height = 164
    Align = alClient
    AllowedOperations = []
    ColumnDefValues.ToolTips = True
    DataSource = srcSingleSerivce
    DynProps = <>
    Flat = True
    FooterRowCount = 1
    FooterParams.Color = clWindow
    GridLineParams.VertEmptySpaceStyle = dessNonEh
    Options = [dgEditing, dgTitles, dgIndicator, dgColumnResize, dgColLines, dgRowLines, dgConfirmDelete, dgCancelOnExit]
    OptionsEh = [dghFixed3D, dghHighlightFocus, dghClearSelection, dghAutoSortMarking, dghMultiSortMarking, dghRowHighlight, dghDialogFind, dghColumnResize, dghColumnMove]
    PopupMenu = pmGrid
    ReadOnly = True
    SearchPanel.FilterOnTyping = True
    SearchPanel.Location = splHorzScrollBarExtraPanelEh
    STFilter.Local = True
    STFilter.Location = stflInTitleFilterEh
    STFilter.Visible = True
    SumList.Active = True
    TabOrder = 1
    TitleParams.MultiTitle = True
    TitleParams.VTitleMargin = 4
    OnDblClick = dbgSingleServDblClick
    Columns = <
      item
        AutoFitColWidth = False
        CellButtons = <>
        DynProps = <>
        EditButtons = <>
        FieldName = 'SERV_DATE'
        Footer.ValueType = fvtCount
        Footers = <>
        Title.Caption = #1044#1072#1090#1072
        Title.TitleButton = True
      end
      item
        AutoFitColWidth = False
        CellButtons = <>
        DynProps = <>
        EditButtons = <>
        FieldName = 'NAME'
        Footers = <>
        Title.Caption = #1053#1072#1080#1084#1077#1085#1086#1074#1072#1085#1080#1077
        Title.TitleButton = True
        Width = 200
      end
      item
        AutoFitColWidth = False
        CellButtons = <>
        DynProps = <>
        EditButtons = <>
        FieldName = 'UNITS'
        Footers = <>
        Title.Caption = #1050#1086#1083'-'#1074#1086
        Title.TitleButton = True
      end
      item
        CellButtons = <>
        DynProps = <>
        EditButtons = <>
        FieldName = 'FEE_CNT'
        Footer.ValueType = fvtSum
        Footers = <>
        Title.Caption = #1053#1072#1095#1080#1089#1083#1077#1085#1086
        Title.TitleButton = True
        Width = 59
      end
      item
        AutoFitColWidth = False
        CellButtons = <>
        DynProps = <>
        EditButtons = <>
        FieldName = 'DIMENSION'
        Footers = <>
        Title.Caption = #1048#1079#1084'.'
        Title.TitleButton = True
        Width = 39
      end
      item
        CellButtons = <>
        DynProps = <>
        EditButtons = <>
        FieldName = 'NOTICE'
        Footers = <>
        Title.Caption = #1055#1088#1080#1084#1077#1095#1072#1085#1080#1077
        Title.TitleButton = True
        Width = 192
      end
      item
        CellButtons = <>
        DynProps = <>
        EditButtons = <>
        FieldName = 'VAT_GROUP'
        Footers = <>
        Title.Caption = #1053#1044#1057
        Title.TitleButton = True
      end
      item
        AutoFitColWidth = False
        CellButtons = <>
        DynProps = <>
        EditButtons = <>
        FieldName = 'WHO_LAST'
        Footers = <>
        Title.Caption = #1044#1086#1073#1072#1074#1080#1083
        Title.TitleButton = True
        Width = 76
      end
      item
        AutoFitColWidth = False
        CellButtons = <>
        DynProps = <>
        EditButtons = <>
        FieldName = 'ADDED_ON'
        Footers = <>
        Title.Caption = #1050#1086#1075#1076#1072
        Title.TitleButton = True
      end
      item
        CellButtons = <>
        DynProps = <>
        EditButtons = <>
        FieldName = 'BUSINESS'
        Footers = <>
        Title.Caption = #1042#1080#1076' '#1091#1089#1083#1091#1075#1080
        Title.TitleButton = True
      end>
    object RowDetailData: TRowDetailPanelControlEh
    end
  end
  object dsSingleService: TpFIBDataSet
    UpdateSQL.Strings = (
      ''
      '    ')
    DeleteSQL.Strings = (
      'DELETE FROM SINGLE_SERV'
      'WHERE'
      '        SINGLE_SERVICE_ID = :OLD_SINGLE_SERVICE_ID'
      '    ')
    RefreshSQL.Strings = (
      'select'
      '  srv.* '
      '  , round((coalesce(cf.fee,0)/coalesce(cf.cnt, 1)), 2) fee_cnt'
      '  , b.O_NAME BUSINESS'
      'from ( select'
      '        Ss.*'
      '        , s.NAME'
      '        , s.BUSINESS_TYPE'
      '        , s.Dimension        '
      '        , coalesce(w.Surname, ss.Added_By) as WHO_LAST'
      '        , o.o_name as VAT_GROUP'
      
        '        , (select count(sl.LINK_ID) from SERVICES_LINKS sl where' +
        ' sl.CHILD = s.service_id and sl.LINK_TYPE = 1 and sl.PARENT is n' +
        'ull) can_delete'
      '      from SINGLE_SERV ss'
      
        '           inner join services s on (s.service_id = ss.service_i' +
        'd)'
      '           left outer join worker w on (w.Ibname = ss.added_by)'
      
        '           left outer join objects o on (o.o_id = ss.vatg_id and' +
        ' o.o_type = 13)'
      '      where SS.CUSTOMER_ID = :CUSTOMER_ID'
      '    ) srv'
      
        '    left outer join (select f.Customer_Id, f.Service_Id, f.Month' +
        '_Id, count(*) cnt, sum(f.Fee) fee '
      '                       from Monthly_Fee f'
      '                      group by 1,2,3) cf'
      '                     on (cf.Customer_Id = srv.Customer_Id '
      '                         and cf.Service_Id = srv.Service_Id  '
      '                         and cf.Month_Id = srv.Serv_Date)'
      
        '     left outer join objects b on (b.O_Id = srv.BUSINESS_TYPE an' +
        'd b.O_TYPE = 15)                         '
      'where srv.SINGLE_SERVICE_ID = :OLD_SINGLE_SERVICE_ID'
      ''
      '    '
      '  ')
    SelectSQL.Strings = (
      'select'
      '  srv.* '
      '  , round((coalesce(cf.fee,0)/coalesce(cf.cnt, 1)), 2) fee_cnt'
      '  , b.O_NAME BUSINESS'
      'from ( select'
      '        Ss.*'
      '        , s.NAME'
      '        , s.BUSINESS_TYPE'
      '        , s.Dimension        '
      '        , coalesce(w.Surname, ss.Added_By) as WHO_LAST'
      '        , o.o_name as VAT_GROUP'
      
        '        , (select count(sl.LINK_ID) from SERVICES_LINKS sl where' +
        ' sl.CHILD = s.service_id and sl.LINK_TYPE = 1 and sl.PARENT is n' +
        'ull) can_delete'
      '      from SINGLE_SERV ss'
      
        '           inner join services s on (s.service_id = ss.service_i' +
        'd)'
      '           left outer join worker w on (w.Ibname = ss.added_by)'
      
        '           left outer join objects o on (o.o_id = ss.vatg_id and' +
        ' o.o_type = 13)'
      '      where SS.CUSTOMER_ID = :CUSTOMER_ID'
      '    ) srv'
      
        '    left outer join (select f.Customer_Id, f.Service_Id, f.Month' +
        '_Id, count(*) cnt, sum(f.Fee) fee '
      '                       from Monthly_Fee f'
      '                      group by 1,2,3) cf'
      '                     on (cf.Customer_Id = srv.Customer_Id '
      '                         and cf.Service_Id = srv.Service_Id  '
      '                         and cf.Month_Id = srv.Serv_Date)'
      
        '     left outer join objects b on (b.O_Id = srv.BUSINESS_TYPE an' +
        'd b.O_TYPE = 15)                         '
      ''
      '  order by srv.SERV_DATE desc')
    AutoUpdateOptions.UpdateTableName = 'SUBSCR_SERV'
    AutoCalcFields = False
    Transaction = trRead
    Database = dmMain.dbTV
    UpdateTransaction = trWrite
    AutoCommit = True
    Left = 78
    Top = 66
    WaitEndMasterScroll = True
    dcForceMasterRefresh = True
  end
  object srcSingleSerivce: TDataSource
    AutoEdit = False
    DataSet = dsSingleService
    OnDataChange = srcSingleSerivceDataChange
    Left = 173
    Top = 69
  end
  object ActListCustomers: TActionList
    Images = A4MainForm.ICONS_ACTIVE
    Left = 285
    Top = 48
    object actAdd: TAction
      Hint = #1044#1086#1073#1072#1074#1080#1090#1100' '#1091#1089#1083#1091#1075#1091' '#1072#1073#1086#1085#1077#1085#1090#1091
      ImageIndex = 2
      OnExecute = actAddExecute
    end
    object actDel: TAction
      ImageIndex = 3
      OnExecute = actDelExecute
    end
    object actEditNotice: TAction
      Caption = #1048#1079#1084#1077#1085#1080#1090#1100' '#1087#1088#1080#1084#1077#1095#1072#1085#1080#1077
      OnExecute = actEditNoticeExecute
    end
  end
  object pmGrid: TPopupMenu
    Left = 392
    Top = 56
    object N1: TMenuItem
      Action = actEditNotice
    end
  end
  object trWrite: TpFIBTransaction
    DefaultDatabase = dmMain.dbTV
    TimeoutAction = TACommit
    TRParams.Strings = (
      'write'
      'nowait'
      'rec_version'
      'read_committed')
    TPBMode = tpbDefault
    Left = 560
    Top = 58
  end
  object trRead: TpFIBTransaction
    DefaultDatabase = dmMain.dbTV
    TimeoutAction = TACommit
    TRParams.Strings = (
      'read'
      'nowait'
      'rec_version'
      'read_committed')
    TPBMode = tpbDefault
    Left = 620
    Top = 58
  end
end
